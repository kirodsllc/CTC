generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model MasterPart {
  id           String   @id @default(uuid())
  masterPartNo String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  parts        Part[]
}

model Brand {
  id        String   @id @default(uuid())
  name      String   @unique
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  parts     Part[]
}

model Category {
  id            String        @id @default(uuid())
  name          String        @unique
  status        String        @default("active")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  parts         Part[]
  subcategories Subcategory[]
}

model Subcategory {
  id           String        @id @default(uuid())
  categoryId   String
  name         String
  status       String        @default("active")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  parts        Part[]
  category     Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, name])
}

model Application {
  id            String      @id @default(uuid())
  subcategoryId String
  name          String
  status        String      @default("active")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  subcategory   Subcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
  parts         Part[]

  @@unique([subcategoryId, name])
}

model Part {
  id                            String                          @id @default(uuid())
  masterPartId                  String?
  partNo                        String
  brandId                       String?
  description                   String?
  categoryId                    String?
  subcategoryId                 String?
  applicationId                 String?
  hsCode                        String?
  weight                        Float?
  reorderLevel                  Int                             @default(0)
  uom                           String                          @default("pcs")
  cost                          Float?
  costSource                    String? // e.g., "DPO_RECEIVED", "PO_RECEIVED", "MANUAL"
  costSourceRef                 String? // Reference to DPO/PO number or ID
  costUpdatedAt                 DateTime? // When cost was last updated
  priceA                        Float?
  priceB                        Float?
  priceM                        Float?
  smc                           String?
  size                          String?
  origin                        String?
  imageP1                       String?
  imageP2                       String?
  status                        String                          @default("active")
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime                        @updatedAt
  adjustmentItems               AdjustmentItem[]
  directPurchaseOrderItems      DirectPurchaseOrderItem[]
  models                        Model[]
  application                   Application?                    @relation(fields: [applicationId], references: [id])
  subcategory                   Subcategory?                    @relation(fields: [subcategoryId], references: [id])
  category                      Category?                       @relation(fields: [categoryId], references: [id])
  brand                         Brand?                          @relation(fields: [brandId], references: [id])
  masterPart                    MasterPart?                     @relation(fields: [masterPartId], references: [id])
  priceHistory                  PriceHistory[]
  purchaseOrderItems            PurchaseOrderItem[]
  stockMovements                StockMovement[]
  verificationItems             StockVerificationItem[]
  transferItems                 TransferItem[]
  kitItems                      KitItem[]
  salesInquiryItems             SalesInquiryItem[]
  salesQuotationItems           SalesQuotationItem[]
  salesInvoiceItems             SalesInvoiceItem[]
  stockReservations             StockReservation[]
  DirectPurchaseOrderReturnItem DirectPurchaseOrderReturnItem[]
  SalesReturnItem               SalesReturnItem[]
}

model Model {
  id        String   @id @default(uuid())
  partId    String
  name      String
  qtyUsed   Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  part      Part     @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@unique([partId, name])
}

model Store {
  id                   String                  @id @default(uuid())
  code                 String                  @unique
  name                 String
  address              String?
  phone                String?
  manager              String?
  status               String                  @default("active")
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  adjustments          Adjustment[]
  directPurchaseOrders DirectPurchaseOrder[]   @relation("DirectPurchaseOrders")
  racks                Rack[]
  stockMovements       StockMovement[]
  verificationItems    StockVerificationItem[] @relation("VerificationItemsStore")
  transfersTo          Transfer[]              @relation("TransfersTo")
  transfersFrom        Transfer[]              @relation("TransfersFrom")
  transferItemsTo      TransferItem[]          @relation("TransferItemsToStore")
  transferItemsFrom    TransferItem[]          @relation("TransferItemsFromStore")
}

model Rack {
  id                       String                    @id @default(uuid())
  codeNo                   String                    @unique
  storeId                  String?
  description              String?
  status                   String                    @default("Active")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  directPurchaseOrderItems DirectPurchaseOrderItem[] @relation("DirectPurchaseOrderItemsRack")
  store                    Store?                    @relation(fields: [storeId], references: [id])
  shelves                  Shelf[]
  stockMovements           StockMovement[]
  verificationItems        StockVerificationItem[]   @relation("VerificationItemsRack")
  transferItemsTo          TransferItem[]            @relation("TransferItemsToRack")
  transferItemsFrom        TransferItem[]            @relation("TransferItemsFromRack")
}

model Shelf {
  id                       String                    @id @default(uuid())
  shelfNo                  String
  rackId                   String
  description              String?
  status                   String                    @default("Active")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  directPurchaseOrderItems DirectPurchaseOrderItem[] @relation("DirectPurchaseOrderItemsShelf")
  rack                     Rack                      @relation(fields: [rackId], references: [id], onDelete: Cascade)
  stockMovements           StockMovement[]
  verificationItems        StockVerificationItem[]   @relation("VerificationItemsShelf")
  transferItemsTo          TransferItem[]            @relation("TransferItemsToShelf")
  transferItemsFrom        TransferItem[]            @relation("TransferItemsFromShelf")

  @@unique([rackId, shelfNo])
}

model StockMovement {
  id            String   @id @default(uuid())
  partId        String
  type          String
  quantity      Int
  storeId       String?
  rackId        String?
  shelfId       String?
  referenceType String?
  referenceId   String?
  notes         String?
  createdAt     DateTime @default(now())
  shelf         Shelf?   @relation(fields: [shelfId], references: [id])
  rack          Rack?    @relation(fields: [rackId], references: [id])
  store         Store?   @relation(fields: [storeId], references: [id])
  part          Part     @relation(fields: [partId], references: [id], onDelete: Cascade)
}

model Transfer {
  id             String         @id @default(uuid())
  transferNumber String         @unique
  date           DateTime
  status         String         @default("Draft")
  notes          String?
  totalQty       Int            @default(0)
  fromStoreId    String?
  toStoreId      String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  toStore        Store?         @relation("TransfersTo", fields: [toStoreId], references: [id])
  fromStore      Store?         @relation("TransfersFrom", fields: [fromStoreId], references: [id])
  items          TransferItem[]
}

model TransferItem {
  id          String   @id @default(uuid())
  transferId  String
  partId      String
  fromStoreId String?
  fromRackId  String?
  fromShelfId String?
  toStoreId   String?
  toRackId    String?
  toShelfId   String?
  quantity    Int
  createdAt   DateTime @default(now())
  toShelf     Shelf?   @relation("TransferItemsToShelf", fields: [toShelfId], references: [id])
  toRack      Rack?    @relation("TransferItemsToRack", fields: [toRackId], references: [id])
  toStore     Store?   @relation("TransferItemsToStore", fields: [toStoreId], references: [id])
  fromShelf   Shelf?   @relation("TransferItemsFromShelf", fields: [fromShelfId], references: [id])
  fromRack    Rack?    @relation("TransferItemsFromRack", fields: [fromRackId], references: [id])
  fromStore   Store?   @relation("TransferItemsFromStore", fields: [fromStoreId], references: [id])
  part        Part     @relation(fields: [partId], references: [id], onDelete: Cascade)
  transfer    Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
}

model Adjustment {
  id           String           @id @default(uuid())
  date         DateTime
  subject      String?
  storeId      String?
  addInventory Boolean          @default(true)
  notes        String?
  totalAmount  Float            @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  store        Store?           @relation(fields: [storeId], references: [id])
  items        AdjustmentItem[]
}

model AdjustmentItem {
  id           String     @id @default(uuid())
  adjustmentId String
  partId       String
  quantity     Int
  cost         Float?
  notes        String?
  createdAt    DateTime   @default(now())
  part         Part       @relation(fields: [partId], references: [id], onDelete: Cascade)
  adjustment   Adjustment @relation(fields: [adjustmentId], references: [id], onDelete: Cascade)
}

model PurchaseOrder {
  id           String              @id @default(uuid())
  poNumber     String              @unique
  date         DateTime
  supplierId   String?
  status       String              @default("Draft")
  expectedDate DateTime?
  notes        String?
  totalAmount  Float               @default(0)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  items        PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  purchaseOrderId String
  partId          String
  quantity        Int
  unitCost        Float
  totalCost       Float
  receivedQty     Int           @default(0)
  notes           String?
  createdAt       DateTime      @default(now())
  part            Part          @relation(fields: [partId], references: [id], onDelete: Cascade)
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
}

model DirectPurchaseOrder {
  id          String                       @id @default(uuid())
  dpoNumber   String                       @unique
  date        DateTime
  storeId     String?
  supplierId  String?
  account     String?
  description String?
  status      String                       @default("Completed")
  totalAmount Float                        @default(0)
  createdAt   DateTime                     @default(now())
  updatedAt   DateTime                     @updatedAt
  store       Store?                       @relation("DirectPurchaseOrders", fields: [storeId], references: [id])
  expenses    DirectPurchaseOrderExpense[]
  items       DirectPurchaseOrderItem[]
  returns     DirectPurchaseOrderReturn[]
}

model DirectPurchaseOrderItem {
  id                    String              @id @default(uuid())
  directPurchaseOrderId String
  partId                String
  quantity              Int
  purchasePrice         Float
  salePrice             Float
  amount                Float
  priceA                Float?
  priceB                Float?
  priceM                Float?
  rackId                String?
  shelfId               String?
  createdAt             DateTime            @default(now())
  shelf                 Shelf?              @relation("DirectPurchaseOrderItemsShelf", fields: [shelfId], references: [id])
  rack                  Rack?               @relation("DirectPurchaseOrderItemsRack", fields: [rackId], references: [id])
  part                  Part                @relation(fields: [partId], references: [id], onDelete: Cascade)
  directPurchaseOrder   DirectPurchaseOrder @relation(fields: [directPurchaseOrderId], references: [id], onDelete: Cascade)
}

model DirectPurchaseOrderExpense {
  id                    String              @id @default(uuid())
  directPurchaseOrderId String
  expenseType           String
  payableAccount        String
  description           String?
  amount                Float
  createdAt             DateTime            @default(now())
  directPurchaseOrder   DirectPurchaseOrder @relation(fields: [directPurchaseOrderId], references: [id], onDelete: Cascade)
}

model DirectPurchaseOrderReturn {
  id                    String                          @id @default(uuid())
  returnNumber          String                          @unique
  directPurchaseOrderId String
  returnDate            DateTime
  reason                String?
  status                String                          @default("pending")
  totalAmount           Float                           @default(0)
  createdAt             DateTime                        @default(now())
  updatedAt             DateTime                        @updatedAt
  directPurchaseOrder   DirectPurchaseOrder             @relation(fields: [directPurchaseOrderId], references: [id], onDelete: Cascade)
  items                 DirectPurchaseOrderReturnItem[]

  @@index([directPurchaseOrderId])
  @@index([status])
}

model DirectPurchaseOrderReturnItem {
  id                    String                    @id @default(uuid())
  dpoReturnId           String
  partId                String
  returnQuantity        Int
  originalPurchasePrice Float
  amount                Float
  createdAt             DateTime                  @default(now())
  dpoReturn             DirectPurchaseOrderReturn @relation(fields: [dpoReturnId], references: [id], onDelete: Cascade)
  part                  Part                      @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([dpoReturnId])
  @@index([partId])
}

model SalesReturn {
  id             String            @id @default(uuid())
  returnNumber   String            @unique
  salesInvoiceId String
  returnDate     DateTime
  reason         String?
  status         String            @default("pending")
  totalAmount    Float             @default(0)
  createdBy      String?
  approvedBy     String?
  approvedAt     DateTime?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  salesInvoice   SalesInvoice      @relation(fields: [salesInvoiceId], references: [id], onDelete: Cascade)
  items          SalesReturnItem[]

  @@index([salesInvoiceId])
  @@index([status])
  @@index([returnDate])
}

model SalesReturnItem {
  id                String      @id @default(uuid())
  salesReturnId     String
  partId            String
  returnQuantity    Int
  originalSalePrice Float
  amount            Float
  createdAt         DateTime    @default(now())
  salesReturn       SalesReturn @relation(fields: [salesReturnId], references: [id], onDelete: Cascade)
  part              Part        @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([salesReturnId])
  @@index([partId])
}

model PriceHistory {
  id           String   @id @default(uuid())
  partId       String?
  partNo       String
  description  String?
  priceField   String
  updateType   String
  oldValue     Float?
  newValue     Float?
  updateValue  Float?
  itemsUpdated Int      @default(1)
  reason       String
  updatedBy    String?
  createdAt    DateTime @default(now())
  part         Part?    @relation(fields: [partId], references: [id])
}

model StockVerification {
  id            String                  @id @default(uuid())
  name          String
  notes         String?
  status        String                  @default("Active")
  startDate     DateTime                @default(now())
  completedDate DateTime?
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  items         StockVerificationItem[]
}

model StockVerificationItem {
  id             String            @id @default(uuid())
  verificationId String
  partId         String
  storeId        String?
  rackId         String?
  shelfId        String?
  systemQty      Int
  physicalQty    Int?
  variance       Int?
  status         String            @default("Pending")
  remarks        String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  shelf          Shelf?            @relation("VerificationItemsShelf", fields: [shelfId], references: [id])
  rack           Rack?             @relation("VerificationItemsRack", fields: [rackId], references: [id])
  store          Store?            @relation("VerificationItemsStore", fields: [storeId], references: [id])
  part           Part              @relation(fields: [partId], references: [id], onDelete: Cascade)
  verification   StockVerification @relation(fields: [verificationId], references: [id], onDelete: Cascade)
}

model ExpenseType {
  id             String          @id @default(uuid())
  code           String          @unique
  name           String
  description    String?
  category       String
  budget         Float           @default(0)
  spent          Float           @default(0)
  status         String          @default("Active")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  postedExpenses PostedExpense[]
}

model PostedExpense {
  id              String      @id @default(uuid())
  date            DateTime
  expenseTypeId   String
  amount          Float
  paidTo          String
  paymentMode     String      @default("Cash")
  referenceNumber String?
  description     String?
  createdAt       DateTime    @default(now())
  expenseType     ExpenseType @relation(fields: [expenseTypeId], references: [id], onDelete: Cascade)
}

model OperationalExpense {
  id          String   @id @default(uuid())
  date        DateTime
  voucherNo   String   @unique
  expenseType String
  description String?
  paidTo      String
  amount      Float
  status      String   @default("Pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MainGroup {
  id           String     @id @default(uuid())
  code         String     @unique
  name         String
  type         String
  displayOrder Int?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  subgroups    Subgroup[]
}

model Subgroup {
  id          String    @id @default(uuid())
  mainGroupId String
  code        String    @unique
  name        String
  isActive    Boolean   @default(true)
  canDelete   Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  accounts    Account[]
  mainGroup   MainGroup @relation(fields: [mainGroupId], references: [id], onDelete: Cascade)
}

model Account {
  id             String         @id @default(uuid())
  subgroupId     String
  code           String         @unique
  name           String
  description    String?
  accountType    String         @default("regular")
  openingBalance Float          @default(0)
  currentBalance Float          @default(0)
  status         String         @default("Active")
  canDelete      Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  subgroup       Subgroup       @relation(fields: [subgroupId], references: [id], onDelete: Cascade)
  journalLines   JournalLine[]
  voucherEntries VoucherEntry[]
  salesInvoices  SalesInvoice[]
}

model JournalEntry {
  id          String        @id @default(uuid())
  entryNo     String        @unique
  entryDate   DateTime
  reference   String?
  description String?
  totalDebit  Float         @default(0)
  totalCredit Float         @default(0)
  status      String        @default("draft")
  createdBy   String?
  postedBy    String?
  postedAt    DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  lines       JournalLine[]
}

model JournalLine {
  id             String       @id @default(uuid())
  journalEntryId String
  accountId      String
  description    String?
  debit          Float        @default(0)
  credit         Float        @default(0)
  lineOrder      Int          @default(0)
  createdAt      DateTime     @default(now())
  account        Account      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
}

model Customer {
  id             String       @id @default(uuid())
  name           String
  address        String?
  email          String?
  cnic           String?
  contactNo      String?
  openingBalance Float        @default(0)
  date           DateTime?
  creditLimit    Float        @default(0)
  status         String       @default("active")
  priceType      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  receivables    Receivable[]
}

model Supplier {
  id             String    @id @default(uuid())
  code           String    @unique
  name           String?
  companyName    String
  address        String?
  city           String?
  state          String?
  country        String?
  zipCode        String?
  email          String?
  phone          String?
  cnic           String?
  contactPerson  String?
  taxId          String?
  paymentTerms   String?
  openingBalance Float     @default(0)
  date           DateTime?
  status         String    @default("active")
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String?
  role      String   @default("Staff")
  status    String   @default("active")
  lastLogin String?  @default("-")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique
  type        String   @default("Custom")
  description String?
  permissions String
  usersCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ActivityLog {
  id          String   @id @default(uuid())
  timestamp   String
  user        String
  userRole    String
  action      String
  actionType  String
  module      String
  description String
  ipAddress   String
  status      String   @default("success")
  details     String?
  createdAt   DateTime @default(now())
}

model ApprovalFlow {
  id          String   @id @default(uuid())
  name        String
  status      String   @default("active")
  description String?
  steps       String
  module      String
  trigger     String   @default("On Create")
  condition   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Backup {
  id        String  @id @default(uuid())
  name      String
  tables    String
  type      String  @default("full")
  size      String?
  status    String  @default("in_progress")
  createdAt String
  createdBy String
}

model BackupSchedule {
  id        String   @id @default(uuid())
  name      String
  frequency String
  tables    String
  time      String
  status    String   @default("active")
  lastRun   String?
  nextRun   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CompanyProfile {
  id                   String   @id @default(uuid())
  companyInfo          String
  systemSettings       String
  invoiceSettings      String
  notificationSettings String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model WhatsAppSettings {
  id                       String   @id @default(uuid())
  appKey                   String?
  authKey                  String?
  administratorPhoneNumber String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
}

model LongCatSettings {
  id        String   @id @default(uuid())
  apiKey    String?
  model     String?  @default("LongCat-Flash-Chat")
  baseUrl   String?  @default("https://api.longcat.chat")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Kit {
  id           String    @id @default(uuid())
  badge        String    @unique
  name         String
  description  String?
  sellingPrice Float     @default(0)
  totalCost    Float     @default(0)
  itemsCount   Int       @default(0)
  status       String    @default("Active")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  items        KitItem[]
}

model KitItem {
  id          String   @id @default(uuid())
  kitId       String
  partId      String
  partNo      String
  partName    String
  quantity    Int      @default(1)
  costPerUnit Float
  createdAt   DateTime @default(now())
  kit         Kit      @relation(fields: [kitId], references: [id], onDelete: Cascade)
  part        Part     @relation(fields: [partId], references: [id], onDelete: Restrict)
}

model Voucher {
  id              String         @id @default(uuid())
  voucherNumber   String         @unique
  type            String // receipt, payment, journal, contra
  date            DateTime
  narration       String?
  cashBankAccount String?
  chequeNumber    String?
  chequeDate      DateTime?
  totalDebit      Float          @default(0)
  totalCredit     Float          @default(0)
  status          String         @default("draft") // draft, posted, cancelled
  createdBy       String?
  approvedBy      String?
  approvedAt      DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  entries         VoucherEntry[]
}

model VoucherEntry {
  id          String   @id @default(uuid())
  voucherId   String
  accountId   String?
  accountName String
  description String?
  debit       Float    @default(0)
  credit      Float    @default(0)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  voucher     Voucher  @relation(fields: [voucherId], references: [id], onDelete: Cascade)
  account     Account? @relation(fields: [accountId], references: [id])
}

// Sales System Models
model SalesInquiry {
  id            String             @id @default(uuid())
  inquiryNo     String             @unique
  inquiryDate   DateTime
  customerName  String
  customerEmail String?
  customerPhone String?
  subject       String
  description   String?
  status        String             @default("New") // New, In Progress, Quoted, Closed, Cancelled
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  items         SalesInquiryItem[]
}

model SalesInquiryItem {
  id            String       @id @default(uuid())
  inquiryId     String
  partId        String
  quantity      Int
  purchasePrice Float?
  priceA        Float?
  priceB        Float?
  priceM        Float?
  location      String?
  stock         Int          @default(0)
  reservedQty   Int          @default(0)
  createdAt     DateTime     @default(now())
  inquiry       SalesInquiry @relation(fields: [inquiryId], references: [id], onDelete: Cascade)
  part          Part         @relation(fields: [partId], references: [id], onDelete: Cascade)
}

model SalesQuotation {
  id              String               @id @default(uuid())
  quotationNo     String               @unique
  quotationDate   DateTime
  validUntil      DateTime
  customerName    String
  customerEmail   String?
  customerPhone   String?
  customerAddress String?
  status          String               @default("draft") // draft, sent, accepted, rejected, expired, converted
  totalAmount     Float                @default(0)
  notes           String?
  invoiceId       String?              @unique // Links to invoice if converted (one-to-one)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  items           SalesQuotationItem[]
  invoice         SalesInvoice?        @relation(fields: [invoiceId], references: [id])
}

model SalesQuotationItem {
  id          String         @id @default(uuid())
  quotationId String
  partId      String
  partNo      String
  description String?
  quantity    Int
  unitPrice   Float
  total       Float
  createdAt   DateTime       @default(now())
  quotation   SalesQuotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  part        Part           @relation(fields: [partId], references: [id], onDelete: Cascade)
}

model SalesInvoice {
  id              String             @id @default(uuid())
  invoiceNo       String             @unique
  invoiceDate     DateTime
  customerId      String?
  customerName    String
  customerType    String // walking, registered
  salesPerson     String?
  subtotal        Float              @default(0)
  overallDiscount Float              @default(0)
  tax             Float              @default(0)
  grandTotal      Float              @default(0)
  paidAmount      Float              @default(0)
  status          String             @default("pending") // draft, pending, partially_delivered, fully_delivered, on_hold, cancelled
  paymentStatus   String             @default("unpaid") // unpaid, partial, paid
  accountId       String? // Account for cash sales
  deliveredTo     String?
  remarks         String?
  quotationId     String? // Links to quotation if converted
  holdReason      String?
  holdSince       DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  items           SalesInvoiceItem[]
  reservations    StockReservation[]
  deliveryLogs    DeliveryLog[]
  receivable      Receivable?
  returns         SalesReturn[]
  account         Account?           @relation(fields: [accountId], references: [id])
  quotation       SalesQuotation?
}

model SalesInvoiceItem {
  id            String            @id @default(uuid())
  invoiceId     String
  partId        String
  partNo        String
  description   String?
  orderedQty    Int
  deliveredQty  Int               @default(0)
  pendingQty    Int
  unitPrice     Float
  discount      Float             @default(0)
  lineTotal     Float
  grade         String?
  brand         String?
  createdAt     DateTime          @default(now())
  invoice       SalesInvoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  part          Part              @relation(fields: [partId], references: [id], onDelete: Cascade)
  deliveryItems DeliveryLogItem[]
}

model StockReservation {
  id         String       @id @default(uuid())
  invoiceId  String
  partId     String
  quantity   Int
  reservedAt DateTime     @default(now())
  releasedAt DateTime?
  status     String       @default("reserved") // reserved, released, out
  invoice    SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  part       Part         @relation(fields: [partId], references: [id], onDelete: Cascade)
}

model DeliveryLog {
  id           String            @id @default(uuid())
  invoiceId    String
  challanNo    String
  deliveryDate DateTime
  deliveredBy  String?
  createdAt    DateTime          @default(now())
  invoice      SalesInvoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  items        DeliveryLogItem[]
}

model DeliveryLogItem {
  id            String           @id @default(uuid())
  deliveryLogId String
  invoiceItemId String
  quantity      Int
  createdAt     DateTime         @default(now())
  deliveryLog   DeliveryLog      @relation(fields: [deliveryLogId], references: [id], onDelete: Cascade)
  invoiceItem   SalesInvoiceItem @relation(fields: [invoiceItemId], references: [id], onDelete: Cascade)
}

model Receivable {
  id         String       @id @default(uuid())
  invoiceId  String       @unique
  customerId String?
  amount     Float
  paidAmount Float        @default(0)
  dueAmount  Float
  dueDate    DateTime?
  status     String       @default("pending") // pending, partial, paid, overdue
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  invoice    SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  customer   Customer?    @relation(fields: [customerId], references: [id])
}
