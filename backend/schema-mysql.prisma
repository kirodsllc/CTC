// =====================================================
// Prisma Schema for MySQL Database
// Inventory ERP System
// Generated: 2026-01-13
// =====================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// =====================================================
// Master Data Models
// =====================================================

model MasterPart {
  id           String   @id @default(uuid())
  masterPartNo String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  parts        Part[]

  @@index([masterPartNo])
  @@map("MasterPart")
}

model Brand {
  id        String   @id @default(uuid())
  name      String   @unique
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  parts     Part[]

  @@index([name])
  @@index([status])
  @@map("Brand")
}

model Category {
  id            String        @id @default(uuid())
  name          String        @unique
  status        String        @default("active")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  parts         Part[]
  subcategories Subcategory[]

  @@index([name])
  @@index([status])
  @@map("Category")
}

model Subcategory {
  id           String        @id @default(uuid())
  categoryId   String
  name         String
  status       String        @default("active")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  parts        Part[]
  category     Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, name])
  @@index([categoryId])
  @@index([status])
  @@map("Subcategory")
}

model Application {
  id            String      @id @default(uuid())
  subcategoryId String
  name          String
  status        String      @default("active")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  subcategory   Subcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
  parts         Part[]

  @@unique([subcategoryId, name])
  @@index([subcategoryId])
  @@index([status])
  @@map("Application")
}

// =====================================================
// Parts and Models
// =====================================================

model Part {
  id                       String                    @id @default(uuid())
  masterPartId             String?
  partNo                   String
  brandId                  String?
  description              String?                   @db.Text
  categoryId               String?
  subcategoryId            String?
  applicationId            String?
  hsCode                   String?
  weight                   Float?
  reorderLevel             Int                       @default(0)
  uom                      String                    @default("pcs")
  cost                     Float?
  priceA                   Float?
  priceB                   Float?
  priceM                   Float?
  smc                      String?
  size                     String?
  origin                   String?
  imageP1                  String?                   @db.Text
  imageP2                  String?                   @db.Text
  status                   String                    @default("active")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  adjustmentItems          AdjustmentItem[]
  directPurchaseOrderItems DirectPurchaseOrderItem[]
  models                   Model[]
  application              Application?              @relation(fields: [applicationId], references: [id])
  subcategory              Subcategory?              @relation(fields: [subcategoryId], references: [id])
  category                 Category?                 @relation(fields: [categoryId], references: [id])
  brand                    Brand?                    @relation(fields: [brandId], references: [id])
  masterPart               MasterPart?               @relation(fields: [masterPartId], references: [id])
  priceHistory             PriceHistory[]
  purchaseOrderItems       PurchaseOrderItem[]
  stockMovements           StockMovement[]
  verificationItems        StockVerificationItem[]
  transferItems            TransferItem[]
  kitItems                 KitItem[]
  salesInquiryItems        SalesInquiryItem[]
  salesQuotationItems      SalesQuotationItem[]
  salesInvoiceItems        SalesInvoiceItem[]
  stockReservations        StockReservation[]

  @@index([partNo])
  @@index([masterPartId])
  @@index([brandId])
  @@index([categoryId])
  @@index([subcategoryId])
  @@index([applicationId])
  @@index([status])
  @@map("Part")
}

model Model {
  id        String   @id @default(uuid())
  partId    String
  name      String
  qtyUsed   Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  part      Part     @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@unique([partId, name])
  @@index([partId])
  @@map("Model")
}

// =====================================================
// Store Management
// =====================================================

model Store {
  id                   String                  @id @default(uuid())
  code                 String                  @unique
  name                 String
  address              String?                 @db.Text
  phone                String?
  manager              String?
  status               String                  @default("active")
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  adjustments          Adjustment[]
  directPurchaseOrders DirectPurchaseOrder[]   @relation("DirectPurchaseOrders")
  racks                Rack[]
  stockMovements       StockMovement[]
  verificationItems    StockVerificationItem[] @relation("VerificationItemsStore")
  transfersTo          Transfer[]              @relation("TransfersTo")
  transfersFrom        Transfer[]              @relation("TransfersFrom")
  transferItemsTo      TransferItem[]          @relation("TransferItemsToStore")
  transferItemsFrom    TransferItem[]          @relation("TransferItemsFromStore")

  @@index([code])
  @@index([status])
  @@map("Store")
}

model Rack {
  id                       String                    @id @default(uuid())
  codeNo                   String                    @unique
  storeId                  String?
  description              String?                   @db.Text
  status                   String                    @default("Active")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  directPurchaseOrderItems DirectPurchaseOrderItem[] @relation("DirectPurchaseOrderItemsRack")
  store                    Store?                    @relation(fields: [storeId], references: [id])
  shelves                  Shelf[]
  stockMovements           StockMovement[]
  verificationItems        StockVerificationItem[]   @relation("VerificationItemsRack")
  transferItemsTo          TransferItem[]            @relation("TransferItemsToRack")
  transferItemsFrom        TransferItem[]            @relation("TransferItemsFromRack")

  @@index([codeNo])
  @@index([storeId])
  @@index([status])
  @@map("Rack")
}

model Shelf {
  id                       String                    @id @default(uuid())
  shelfNo                  String
  rackId                   String
  description              String?                   @db.Text
  status                   String                    @default("Active")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  directPurchaseOrderItems DirectPurchaseOrderItem[] @relation("DirectPurchaseOrderItemsShelf")
  rack                     Rack                      @relation(fields: [rackId], references: [id], onDelete: Cascade)
  stockMovements           StockMovement[]
  verificationItems        StockVerificationItem[]   @relation("VerificationItemsShelf")
  transferItemsTo          TransferItem[]            @relation("TransferItemsToShelf")
  transferItemsFrom        TransferItem[]            @relation("TransferItemsFromShelf")

  @@unique([rackId, shelfNo])
  @@index([rackId])
  @@index([status])
  @@map("Shelf")
}

// =====================================================
// Stock Management
// =====================================================

model StockMovement {
  id            String   @id @default(uuid())
  partId        String
  type          String
  quantity      Int
  storeId       String?
  rackId        String?
  shelfId       String?
  referenceType String?
  referenceId   String?
  notes         String?  @db.Text
  createdAt     DateTime @default(now())
  shelf         Shelf?   @relation(fields: [shelfId], references: [id])
  rack          Rack?    @relation(fields: [rackId], references: [id])
  store         Store?   @relation(fields: [storeId], references: [id])
  part          Part     @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([partId])
  @@index([type])
  @@index([storeId])
  @@index([rackId])
  @@index([shelfId])
  @@index([referenceType, referenceId])
  @@index([createdAt])
  @@map("StockMovement")
}

model Transfer {
  id             String         @id @default(uuid())
  transferNumber String         @unique
  date           DateTime
  status         String         @default("Draft")
  notes          String?        @db.Text
  totalQty       Int            @default(0)
  fromStoreId    String?
  toStoreId      String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  toStore        Store?         @relation("TransfersTo", fields: [toStoreId], references: [id])
  fromStore      Store?         @relation("TransfersFrom", fields: [fromStoreId], references: [id])
  items          TransferItem[]

  @@index([transferNumber])
  @@index([status])
  @@index([date])
  @@index([fromStoreId])
  @@index([toStoreId])
  @@map("Transfer")
}

model TransferItem {
  id          String   @id @default(uuid())
  transferId  String
  partId      String
  fromStoreId String?
  fromRackId  String?
  fromShelfId String?
  toStoreId   String?
  toRackId    String?
  toShelfId   String?
  quantity    Int
  createdAt   DateTime @default(now())
  toShelf     Shelf?   @relation("TransferItemsToShelf", fields: [toShelfId], references: [id])
  toRack      Rack?    @relation("TransferItemsToRack", fields: [toRackId], references: [id])
  toStore     Store?   @relation("TransferItemsToStore", fields: [toStoreId], references: [id])
  fromShelf   Shelf?   @relation("TransferItemsFromShelf", fields: [fromShelfId], references: [id])
  fromRack    Rack?    @relation("TransferItemsFromRack", fields: [fromRackId], references: [id])
  fromStore   Store?   @relation("TransferItemsFromStore", fields: [fromStoreId], references: [id])
  part        Part     @relation(fields: [partId], references: [id], onDelete: Cascade)
  transfer    Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@index([transferId])
  @@index([partId])
  @@map("TransferItem")
}

model Adjustment {
  id           String           @id @default(uuid())
  date         DateTime
  subject      String?
  storeId      String?
  addInventory Boolean          @default(true)
  notes        String?          @db.Text
  totalAmount  Float            @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  store        Store?           @relation(fields: [storeId], references: [id])
  items        AdjustmentItem[]

  @@index([date])
  @@index([storeId])
  @@map("Adjustment")
}

model AdjustmentItem {
  id           String     @id @default(uuid())
  adjustmentId String
  partId       String
  quantity     Int
  cost         Float?
  notes        String?    @db.Text
  createdAt    DateTime   @default(now())
  part         Part       @relation(fields: [partId], references: [id], onDelete: Cascade)
  adjustment   Adjustment @relation(fields: [adjustmentId], references: [id], onDelete: Cascade)

  @@index([adjustmentId])
  @@index([partId])
  @@map("AdjustmentItem")
}

// =====================================================
// Purchase Management
// =====================================================

model PurchaseOrder {
  id           String              @id @default(uuid())
  poNumber     String              @unique
  date         DateTime
  supplierId   String?
  status       String              @default("Draft")
  expectedDate DateTime?
  notes        String?             @db.Text
  totalAmount  Float               @default(0)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  items        PurchaseOrderItem[]

  @@index([poNumber])
  @@index([status])
  @@index([date])
  @@index([supplierId])
  @@map("PurchaseOrder")
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  purchaseOrderId String
  partId          String
  quantity        Int
  unitCost        Float
  totalCost       Float
  receivedQty     Int           @default(0)
  notes           String?       @db.Text
  createdAt       DateTime      @default(now())
  part            Part          @relation(fields: [partId], references: [id], onDelete: Cascade)
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([purchaseOrderId])
  @@index([partId])
  @@map("PurchaseOrderItem")
}

model DirectPurchaseOrder {
  id          String                       @id @default(uuid())
  dpoNumber   String                       @unique
  date        DateTime
  storeId     String?
  supplierId  String?
  account     String?
  description String?                      @db.Text
  status      String                       @default("Completed")
  totalAmount Float                        @default(0)
  createdAt   DateTime                     @default(now())
  updatedAt   DateTime                     @updatedAt
  store       Store?                       @relation("DirectPurchaseOrders", fields: [storeId], references: [id])
  expenses    DirectPurchaseOrderExpense[]
  items       DirectPurchaseOrderItem[]

  @@index([dpoNumber])
  @@index([status])
  @@index([date])
  @@index([storeId])
  @@index([supplierId])
  @@map("DirectPurchaseOrder")
}

model DirectPurchaseOrderItem {
  id                    String              @id @default(uuid())
  directPurchaseOrderId String
  partId                String
  quantity              Int
  purchasePrice         Float
  salePrice             Float
  amount                Float
  priceA                Float?
  priceB                Float?
  priceM                Float?
  rackId                String?
  shelfId               String?
  createdAt             DateTime            @default(now())
  shelf                 Shelf?              @relation("DirectPurchaseOrderItemsShelf", fields: [shelfId], references: [id])
  rack                  Rack?               @relation("DirectPurchaseOrderItemsRack", fields: [rackId], references: [id])
  part                  Part                @relation(fields: [partId], references: [id], onDelete: Cascade)
  directPurchaseOrder   DirectPurchaseOrder @relation(fields: [directPurchaseOrderId], references: [id], onDelete: Cascade)

  @@index([directPurchaseOrderId])
  @@index([partId])
  @@index([rackId])
  @@index([shelfId])
  @@map("DirectPurchaseOrderItem")
}

model DirectPurchaseOrderExpense {
  id                    String              @id @default(uuid())
  directPurchaseOrderId String
  expenseType           String
  payableAccount        String
  description           String?             @db.Text
  amount                Float
  createdAt             DateTime            @default(now())
  directPurchaseOrder   DirectPurchaseOrder @relation(fields: [directPurchaseOrderId], references: [id], onDelete: Cascade)

  @@index([directPurchaseOrderId])
  @@map("DirectPurchaseOrderExpense")
}

model PriceHistory {
  id           String   @id @default(uuid())
  partId       String?
  partNo       String
  description  String?  @db.Text
  priceField   String
  updateType   String
  oldValue     Float?
  newValue     Float?
  updateValue  Float?
  itemsUpdated Int      @default(1)
  reason       String   @db.Text
  updatedBy    String?
  createdAt    DateTime @default(now())
  part         Part?    @relation(fields: [partId], references: [id])

  @@index([partId])
  @@index([partNo])
  @@index([priceField])
  @@index([createdAt])
  @@map("PriceHistory")
}

// =====================================================
// Stock Verification
// =====================================================

model StockVerification {
  id            String                  @id @default(uuid())
  name          String
  notes         String?                 @db.Text
  status        String                  @default("Active")
  startDate     DateTime                @default(now())
  completedDate DateTime?
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  items         StockVerificationItem[]

  @@index([status])
  @@index([startDate])
  @@map("StockVerification")
}

model StockVerificationItem {
  id             String            @id @default(uuid())
  verificationId String
  partId         String
  storeId        String?
  rackId         String?
  shelfId        String?
  systemQty      Int
  physicalQty    Int?
  variance       Int?
  status         String            @default("Pending")
  remarks        String?           @db.Text
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  shelf          Shelf?            @relation("VerificationItemsShelf", fields: [shelfId], references: [id])
  rack           Rack?             @relation("VerificationItemsRack", fields: [rackId], references: [id])
  store          Store?            @relation("VerificationItemsStore", fields: [storeId], references: [id])
  part           Part              @relation(fields: [partId], references: [id], onDelete: Cascade)
  verification   StockVerification @relation(fields: [verificationId], references: [id], onDelete: Cascade)

  @@index([verificationId])
  @@index([partId])
  @@index([status])
  @@map("StockVerificationItem")
}

// =====================================================
// Expense Management
// =====================================================

model ExpenseType {
  id             String          @id @default(uuid())
  code           String          @unique
  name           String
  description    String?         @db.Text
  category       String
  budget         Float           @default(0)
  spent          Float           @default(0)
  status         String          @default("Active")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  postedExpenses PostedExpense[]

  @@index([code])
  @@index([status])
  @@map("ExpenseType")
}

model PostedExpense {
  id              String      @id @default(uuid())
  date            DateTime
  expenseTypeId   String
  amount          Float
  paidTo          String
  paymentMode     String      @default("Cash")
  referenceNumber String?
  description     String?     @db.Text
  createdAt       DateTime    @default(now())
  expenseType     ExpenseType @relation(fields: [expenseTypeId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([expenseTypeId])
  @@map("PostedExpense")
}

model OperationalExpense {
  id          String   @id @default(uuid())
  date        DateTime
  voucherNo   String   @unique
  expenseType String
  description String?  @db.Text
  paidTo      String
  amount      Float
  status      String   @default("Pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([voucherNo])
  @@index([date])
  @@index([status])
  @@map("OperationalExpense")
}

// =====================================================
// Accounting System
// =====================================================

model MainGroup {
  id           String     @id @default(uuid())
  code         String     @unique
  name         String
  type         String
  displayOrder Int?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  subgroups    Subgroup[]

  @@index([code])
  @@index([type])
  @@map("MainGroup")
}

model Subgroup {
  id          String    @id @default(uuid())
  mainGroupId String
  code        String    @unique
  name        String
  isActive    Boolean   @default(true)
  canDelete   Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  accounts    Account[]
  mainGroup   MainGroup @relation(fields: [mainGroupId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([mainGroupId])
  @@map("Subgroup")
}

model Account {
  id             String         @id @default(uuid())
  subgroupId     String
  code           String         @unique
  name           String
  description    String?        @db.Text
  accountType    String         @default("regular")
  openingBalance Float          @default(0)
  currentBalance Float          @default(0)
  status         String         @default("Active")
  canDelete      Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  subgroup       Subgroup       @relation(fields: [subgroupId], references: [id], onDelete: Cascade)
  journalLines   JournalLine[]
  voucherEntries VoucherEntry[]
  salesInvoices  SalesInvoice[]

  @@index([code])
  @@index([subgroupId])
  @@index([status])
  @@map("Account")
}

model JournalEntry {
  id          String        @id @default(uuid())
  entryNo     String        @unique
  entryDate   DateTime
  reference   String?
  description String?       @db.Text
  totalDebit  Float         @default(0)
  totalCredit Float         @default(0)
  status      String        @default("draft")
  createdBy   String?
  postedBy    String?
  postedAt    DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  lines       JournalLine[]

  @@index([entryNo])
  @@index([entryDate])
  @@index([status])
  @@map("JournalEntry")
}

model JournalLine {
  id             String       @id @default(uuid())
  journalEntryId String
  accountId      String
  description    String?      @db.Text
  debit          Float        @default(0)
  credit         Float        @default(0)
  lineOrder      Int          @default(0)
  createdAt      DateTime     @default(now())
  account        Account      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@index([journalEntryId])
  @@index([accountId])
  @@map("JournalLine")
}

// =====================================================
// Customers and Suppliers
// =====================================================

model Customer {
  id             String       @id @default(uuid())
  name           String
  address        String?      @db.Text
  email          String?
  cnic           String?
  contactNo      String?
  openingBalance Float        @default(0)
  date           DateTime?
  creditLimit    Float        @default(0)
  status         String       @default("active")
  priceType      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  receivables    Receivable[]

  @@index([name])
  @@index([status])
  @@index([email])
  @@map("Customer")
}

model Supplier {
  id             String    @id @default(uuid())
  code           String    @unique
  name           String?
  companyName    String
  address        String?   @db.Text
  city           String?
  state          String?
  country        String?
  zipCode        String?
  email          String?
  phone          String?
  cnic           String?
  contactPerson  String?
  taxId          String?
  paymentTerms   String?
  openingBalance Float     @default(0)
  date           DateTime?
  status         String    @default("active")
  notes          String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([code])
  @@index([status])
  @@index([email])
  @@map("Supplier")
}

// =====================================================
// User Management
// =====================================================

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String?
  role      String   @default("Staff")
  status    String   @default("active")
  lastLogin String?  @default("-")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([status])
  @@index([role])
  @@map("User")
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique
  type        String   @default("Custom")
  description String?  @db.Text
  permissions String   @db.Text
  usersCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@index([type])
  @@map("Role")
}

// =====================================================
// Activity Logs and Approval Flows
// =====================================================

model ActivityLog {
  id          String   @id @default(uuid())
  timestamp   String
  user        String
  userRole    String
  action      String
  actionType  String
  module      String
  description String   @db.Text
  ipAddress   String
  status      String   @default("success")
  details     String?  @db.Text
  createdAt   DateTime @default(now())

  @@index([user])
  @@index([module])
  @@index([actionType])
  @@index([createdAt])
  @@map("ActivityLog")
}

model ApprovalFlow {
  id          String   @id @default(uuid())
  name        String
  status      String   @default("active")
  description String?  @db.Text
  steps       String   @db.Text
  module      String
  trigger     String   @default("On Create")
  condition   String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([module])
  @@index([status])
  @@map("ApprovalFlow")
}

// =====================================================
// Backup Management
// =====================================================

model Backup {
  id        String @id @default(uuid())
  name      String
  tables    String @db.Text
  type      String @default("full")
  size      String?
  status    String @default("in_progress")
  createdAt String
  createdBy String

  @@index([status])
  @@index([type])
  @@map("Backup")
}

model BackupSchedule {
  id        String   @id @default(uuid())
  name      String
  frequency String
  tables    String   @db.Text
  time      String
  status    String   @default("active")
  lastRun   String?
  nextRun   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@map("BackupSchedule")
}

// =====================================================
// System Settings
// =====================================================

model CompanyProfile {
  id                   String   @id @default(uuid())
  companyInfo          String   @db.Text
  systemSettings       String   @db.Text
  invoiceSettings      String   @db.Text
  notificationSettings String   @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("CompanyProfile")
}

model WhatsAppSettings {
  id                       String   @id @default(uuid())
  appKey                   String?
  authKey                  String?
  administratorPhoneNumber String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  @@map("WhatsAppSettings")
}

model LongCatSettings {
  id        String   @id @default(uuid())
  apiKey    String?
  model     String?  @default("LongCat-Flash-Chat")
  baseUrl   String?  @default("https://api.longcat.chat")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("LongCatSettings")
}

// =====================================================
// Kits Management
// =====================================================

model Kit {
  id           String    @id @default(uuid())
  badge        String    @unique
  name         String
  description  String?   @db.Text
  sellingPrice Float     @default(0)
  totalCost    Float     @default(0)
  itemsCount   Int       @default(0)
  status       String    @default("Active")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  items        KitItem[]

  @@index([badge])
  @@index([status])
  @@map("Kit")
}

model KitItem {
  id          String   @id @default(uuid())
  kitId       String
  partId      String
  partNo      String
  partName    String
  quantity    Int      @default(1)
  costPerUnit Float
  createdAt   DateTime @default(now())
  kit         Kit      @relation(fields: [kitId], references: [id], onDelete: Cascade)
  part        Part     @relation(fields: [partId], references: [id], onDelete: Restrict)

  @@index([kitId])
  @@index([partId])
  @@map("KitItem")
}

// =====================================================
// Vouchers System
// =====================================================

model Voucher {
  id              String         @id @default(uuid())
  voucherNumber   String         @unique
  type            String
  date            DateTime
  narration       String?        @db.Text
  cashBankAccount String?
  chequeNumber    String?
  chequeDate      DateTime?
  totalDebit      Float          @default(0)
  totalCredit     Float          @default(0)
  status          String         @default("draft")
  createdBy       String?
  approvedBy      String?
  approvedAt      DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  entries         VoucherEntry[]

  @@index([voucherNumber])
  @@index([type])
  @@index([date])
  @@index([status])
  @@map("Voucher")
}

model VoucherEntry {
  id          String   @id @default(uuid())
  voucherId   String
  accountId   String?
  accountName String
  description String?  @db.Text
  debit       Float    @default(0)
  credit      Float    @default(0)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  voucher     Voucher  @relation(fields: [voucherId], references: [id], onDelete: Cascade)
  account     Account? @relation(fields: [accountId], references: [id])

  @@index([voucherId])
  @@index([accountId])
  @@map("VoucherEntry")
}

// =====================================================
// Sales System
// =====================================================

model SalesInquiry {
  id            String             @id @default(uuid())
  inquiryNo     String             @unique
  inquiryDate   DateTime
  customerName  String
  customerEmail String?
  customerPhone String?
  subject       String
  description   String?            @db.Text
  status        String             @default("New")
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  items         SalesInquiryItem[]

  @@index([inquiryNo])
  @@index([status])
  @@index([inquiryDate])
  @@map("SalesInquiry")
}

model SalesInquiryItem {
  id            String       @id @default(uuid())
  inquiryId     String
  partId        String
  quantity      Int
  purchasePrice Float?
  priceA        Float?
  priceB        Float?
  priceM        Float?
  location      String?
  stock         Int          @default(0)
  reservedQty   Int          @default(0)
  createdAt     DateTime     @default(now())
  inquiry       SalesInquiry @relation(fields: [inquiryId], references: [id], onDelete: Cascade)
  part          Part         @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([inquiryId])
  @@index([partId])
  @@map("SalesInquiryItem")
}

model SalesQuotation {
  id              String               @id @default(uuid())
  quotationNo     String               @unique
  quotationDate   DateTime
  validUntil      DateTime
  customerName    String
  customerEmail   String?
  customerPhone   String?
  customerAddress String?              @db.Text
  status          String               @default("draft")
  totalAmount     Float                @default(0)
  notes           String?              @db.Text
  invoiceId       String?              @unique
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  items           SalesQuotationItem[]
  invoice         SalesInvoice?        @relation(fields: [invoiceId], references: [id])

  @@index([quotationNo])
  @@index([status])
  @@index([quotationDate])
  @@map("SalesQuotation")
}

model SalesQuotationItem {
  id          String         @id @default(uuid())
  quotationId String
  partId      String
  partNo      String
  description String?        @db.Text
  quantity    Int
  unitPrice   Float
  total       Float
  createdAt   DateTime       @default(now())
  quotation   SalesQuotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  part        Part           @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([quotationId])
  @@index([partId])
  @@map("SalesQuotationItem")
}

model SalesInvoice {
  id              String             @id @default(uuid())
  invoiceNo       String             @unique
  invoiceDate     DateTime
  customerId      String?
  customerName    String
  customerType    String
  salesPerson     String?
  subtotal        Float              @default(0)
  overallDiscount Float              @default(0)
  tax             Float              @default(0)
  grandTotal      Float              @default(0)
  paidAmount      Float              @default(0)
  status          String             @default("pending")
  paymentStatus   String             @default("unpaid")
  accountId       String?
  deliveredTo     String?
  remarks         String?            @db.Text
  quotationId     String?
  holdReason      String?            @db.Text
  holdSince       DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  items           SalesInvoiceItem[]
  reservations    StockReservation[]
  deliveryLogs    DeliveryLog[]
  receivable      Receivable?
  account         Account?           @relation(fields: [accountId], references: [id])
  quotation       SalesQuotation?

  @@index([invoiceNo])
  @@index([customerId])
  @@index([status])
  @@index([paymentStatus])
  @@index([invoiceDate])
  @@map("SalesInvoice")
}

model SalesInvoiceItem {
  id            String            @id @default(uuid())
  invoiceId     String
  partId        String
  partNo        String
  description   String?           @db.Text
  orderedQty    Int
  deliveredQty  Int               @default(0)
  pendingQty    Int
  unitPrice     Float
  discount      Float             @default(0)
  lineTotal     Float
  grade         String?
  brand         String?
  createdAt     DateTime          @default(now())
  invoice       SalesInvoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  part          Part              @relation(fields: [partId], references: [id], onDelete: Cascade)
  deliveryItems DeliveryLogItem[]

  @@index([invoiceId])
  @@index([partId])
  @@map("SalesInvoiceItem")
}

model StockReservation {
  id         String       @id @default(uuid())
  invoiceId  String
  partId     String
  quantity   Int
  reservedAt DateTime     @default(now())
  releasedAt DateTime?
  status     String       @default("reserved")
  invoice    SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  part       Part         @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([partId])
  @@index([status])
  @@map("StockReservation")
}

model DeliveryLog {
  id           String            @id @default(uuid())
  invoiceId    String
  challanNo    String
  deliveryDate DateTime
  deliveredBy  String?
  createdAt    DateTime          @default(now())
  invoice      SalesInvoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  items        DeliveryLogItem[]

  @@index([invoiceId])
  @@index([challanNo])
  @@index([deliveryDate])
  @@map("DeliveryLog")
}

model DeliveryLogItem {
  id            String           @id @default(uuid())
  deliveryLogId String
  invoiceItemId String
  quantity      Int
  createdAt     DateTime         @default(now())
  deliveryLog   DeliveryLog      @relation(fields: [deliveryLogId], references: [id], onDelete: Cascade)
  invoiceItem   SalesInvoiceItem @relation(fields: [invoiceItemId], references: [id], onDelete: Cascade)

  @@index([deliveryLogId])
  @@index([invoiceItemId])
  @@map("DeliveryLogItem")
}

model Receivable {
  id         String       @id @default(uuid())
  invoiceId  String       @unique
  customerId String?
  amount     Float
  paidAmount Float        @default(0)
  dueAmount  Float
  dueDate    DateTime?
  status     String       @default("pending")
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  invoice    SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  customer   Customer?    @relation(fields: [customerId], references: [id])

  @@index([invoiceId])
  @@index([customerId])
  @@index([status])
  @@map("Receivable")
}

// =====================================================
// End of Schema
// =====================================================
